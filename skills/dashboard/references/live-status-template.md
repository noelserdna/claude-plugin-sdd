# Live Status Template

JSONP template for the dashboard's live activity feed. Skills write this file to `dashboard/live-status.js` during execution to provide real-time status updates to the open dashboard.

## How It Works

1. The dashboard polls `./live-status.js` every 5 seconds via `<script>` tag injection
2. The file calls `window.__SDD_LIVE_UPDATE(data)` with the current status
3. The dashboard updates the activity feed and pipeline stage indicators
4. Works with `file://` protocol (no server needed)

## Schema

```javascript
window.__SDD_LIVE_UPDATE({
  "sessionId": "uuid-or-timestamp",
  "currentStage": "specifications-engineer",
  "status": "running",
  "lastHeartbeat": "2026-03-01T10:30:00.000Z",
  "progress": 45,
  "message": "Processing UC-003...",
  "history": [
    {
      "timestamp": "2026-03-01T10:28:00.000Z",
      "stage": "specifications-engineer",
      "message": "Starting specifications generation",
      "type": "running"
    },
    {
      "timestamp": "2026-03-01T10:29:30.000Z",
      "stage": "specifications-engineer",
      "message": "Generated UC-001, UC-002",
      "type": "info"
    },
    {
      "timestamp": "2026-03-01T10:30:00.000Z",
      "stage": "specifications-engineer",
      "message": "Processing UC-003...",
      "type": "running"
    }
  ]
});
```

## Field Reference

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `sessionId` | string | Yes | Unique session identifier (timestamp or UUID) |
| `currentStage` | string | Yes | Pipeline stage name (e.g., `"specifications-engineer"`) |
| `status` | string | Yes | `"idle"`, `"running"`, `"done"`, `"error"` |
| `lastHeartbeat` | ISO-8601 | Yes | Timestamp of last update (used for stale detection) |
| `progress` | number | No | 0-100 progress percentage (null if indeterminate) |
| `message` | string | No | Human-readable current activity message |
| `history` | array | Yes | Array of activity entries (max 50, newest last) |

### History Entry

| Field | Type | Description |
|-------|------|-------------|
| `timestamp` | ISO-8601 | When this event occurred |
| `stage` | string | Pipeline stage name |
| `message` | string | Human-readable event description |
| `type` | string | `"running"`, `"done"`, `"error"`, `"info"` |

## Idle Seed File

The dashboard skill generates an idle seed file after dashboard generation. This establishes the file for the polling system to find.

```javascript
// SDD Live Status â€” generated by /sdd:dashboard
// Skills update this file during execution to show real-time progress
window.__SDD_LIVE_UPDATE({
  "sessionId": null,
  "currentStage": null,
  "status": "idle",
  "lastHeartbeat": "{{TIMESTAMP}}",
  "progress": null,
  "message": "Dashboard generated. Waiting for pipeline activity.",
  "history": []
});
```

## Instructions for Skills

Skills that want to provide live feedback should:

1. **On start**: Write `dashboard/live-status.js` with `status: "running"`, initial history entry
2. **During execution**: Update the file periodically (every major step) with new history entries and updated `lastHeartbeat`
3. **On completion**: Write final update with `status: "done"` and completion history entry
4. **On error**: Write update with `status: "error"` and error history entry
5. **Keep history under 50 entries**: Trim oldest entries if needed

### Example Update Pattern

```javascript
// At start of skill execution:
window.__SDD_LIVE_UPDATE({
  "sessionId": "2026-03-01T10:28:00.000Z",
  "currentStage": "task-generator",
  "status": "running",
  "lastHeartbeat": "2026-03-01T10:28:00.000Z",
  "progress": 0,
  "message": "Starting task generation...",
  "history": [
    {"timestamp":"2026-03-01T10:28:00.000Z","stage":"task-generator","message":"Starting task generation","type":"running"}
  ]
});

// After completing a step:
window.__SDD_LIVE_UPDATE({
  "sessionId": "2026-03-01T10:28:00.000Z",
  "currentStage": "task-generator",
  "status": "running",
  "lastHeartbeat": "2026-03-01T10:30:00.000Z",
  "progress": 50,
  "message": "Generated 12 tasks for FASE-1",
  "history": [
    {"timestamp":"2026-03-01T10:28:00.000Z","stage":"task-generator","message":"Starting task generation","type":"running"},
    {"timestamp":"2026-03-01T10:30:00.000Z","stage":"task-generator","message":"Generated 12 tasks for FASE-1","type":"info"}
  ]
});

// On completion:
window.__SDD_LIVE_UPDATE({
  "sessionId": "2026-03-01T10:28:00.000Z",
  "currentStage": "task-generator",
  "status": "done",
  "lastHeartbeat": "2026-03-01T10:32:00.000Z",
  "progress": 100,
  "message": "Task generation complete. 24 tasks generated.",
  "history": [
    {"timestamp":"2026-03-01T10:28:00.000Z","stage":"task-generator","message":"Starting task generation","type":"running"},
    {"timestamp":"2026-03-01T10:30:00.000Z","stage":"task-generator","message":"Generated 12 tasks for FASE-1","type":"info"},
    {"timestamp":"2026-03-01T10:32:00.000Z","stage":"task-generator","message":"Task generation complete. 24 tasks generated.","type":"done"}
  ]
});
```

## Error Handling in Dashboard

The dashboard handles these error cases gracefully:

| Scenario | Dashboard Behavior |
|----------|-------------------|
| File not found (404) | Silent no-op, live dot hidden after 3 failures |
| Syntax error in JS | Script load fails, "Status file corrupted" implied by no update |
| Stale heartbeat (>60s + running) | Shows "Possibly stalled" warning in feed |
| Old timestamp (race condition) | Ignores update, keeps newer data |
| Empty history array | Shows "No live activity" empty state |
| Missing fields | Defaults to safe values (null, empty arrays) |
